<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Snowball Pro - Simulateur de Pr√©cision S&P 500</title>
    <meta name="description"
        content="Simulateur haute pr√©cision d'int√©r√™ts compos√©s bas√© sur l'historique r√©el du S&P 500 (1928-2024).">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚ùÑÔ∏è</text></svg>">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');

        :root {
            --bg-deep: #05060f;
            --bg-card: #0f111a;
            --accent: #6366f1;
            --accent-glow: rgba(99, 102, 241, 0.3);
            --glass: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.08);
        }

        body {
            background-color: var(--bg-deep);
            font-family: 'Plus Jakarta Sans', sans-serif;
            color: #f1f5f9;
            -webkit-tap-highlight-color: transparent;
        }

        .glass-card {
            background: var(--bg-card);
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(10px);
            border-radius: 20px;
        }

        .input-precision {
            background: transparent;
            text-align: right;
            border: none;
            font-weight: 800;
            font-size: 1.5rem;
            color: white;
            outline: none;
            width: 100%;
        }

        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
            height: 32px;
        }

        input[type=range]::-webkit-slider-runnable-track {
            background: #1e293b;
            height: 6px;
            border-radius: 3px;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 24px;
            width: 24px;
            border-radius: 50%;
            background: #fff;
            border: 4px solid var(--accent);
            box-shadow: 0 0 20px var(--accent-glow);
            margin-top: -9px;
            cursor: pointer;
            transition: transform 0.1s;
        }

        input[type=range]::-webkit-slider-thumb:active {
            transform: scale(1.2);
        }

        .gradient-text {
            background: linear-gradient(135deg, #fff 0%, #94a3b8 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 10px;
        }

        .btn-preset {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            padding: 8px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            transition: all 0.2s;
        }

        .btn-preset:hover {
            background: rgba(99, 102, 241, 0.1);
            border-color: var(--accent);
        }

        .btn-preset.active {
            background: var(--accent);
            color: white;
            box-shadow: 0 8px 16px var(--accent-glow);
        }

        @keyframes float {
            0% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-5px);
            }

            100% {
                transform: translateY(0px);
            }
        }

        .animate-float {
            animation: float 3s ease-in-out infinite;
        }
    </style>
</head>

<body class="h-screen flex flex-col md:flex-row overflow-hidden">

    <!-- SIDEBAR: Param√®tres -->
    <aside class="w-full md:w-[450px] bg-[#080a14] border-r border-[#1e293b] flex flex-col z-20 shadow-2xl">
        <div class="p-6 md:p-8 overflow-y-auto custom-scrollbar space-y-8 h-full">

            <div class="flex items-center gap-3">
                <div
                    class="w-10 h-10 rounded-xl bg-indigo-600 flex items-center justify-center text-white font-bold text-xl shadow-lg shadow-indigo-500/20">
                    ‚ùÑÔ∏è</div>
                <div>
                    <h1 class="text-xl font-bold tracking-tight">Snowball Pro</h1>
                    <p class="text-[10px] text-indigo-400 font-bold uppercase tracking-widest">Powered by S&P 500 Data
                    </p>
                </div>
            </div>

            <!-- Configuration Initiale -->
            <div class="space-y-6">
                <div class="glass-card p-5 border-indigo-500/20 bg-indigo-500/[0.02]">
                    <div class="flex justify-between items-center mb-1">
                        <label class="text-[10px] font-bold text-indigo-300 uppercase">Salaire Net Mensuel</label>
                        <span class="text-[10px] bg-indigo-500/20 px-2 py-0.5 rounded text-indigo-300">Aide au
                            budget</span>
                    </div>
                    <div class="flex gap-4 items-center">
                        <input type="number" id="salaryInput" value="2500" class="input-precision !text-left !text-xl"
                            oninput="update()">
                        <button onclick="applyBudget()"
                            class="bg-indigo-600 hover:bg-indigo-500 text-white px-4 py-2 rounded-xl transition text-xs font-bold active:scale-95">Calculer
                            %</button>
                    </div>
                </div>

                <div class="space-y-4">
                    <h3 class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Montants</h3>

                    <div class="glass-card p-4">
                        <p class="text-[10px] text-slate-400 font-bold uppercase mb-2">Capital de d√©part (‚Ç¨)</p>
                        <div class="flex items-center gap-4">
                            <input type="number" id="initial" value="1000" class="input-precision" oninput="update()">
                            <div class="flex flex-col gap-1">
                                <button onclick="changeValue('initial', 100)"
                                    class="w-8 h-8 bg-slate-800 rounded-lg hover:bg-slate-700 active:scale-95">+</button>
                                <button onclick="changeValue('initial', -100)"
                                    class="w-8 h-8 bg-slate-800 rounded-lg hover:bg-slate-700 active:scale-95">-</button>
                            </div>
                        </div>
                    </div>

                    <div class="glass-card p-4 relative overflow-hidden group">
                        <div
                            class="absolute inset-0 bg-indigo-600/5 opacity-0 group-hover:opacity-100 transition-opacity">
                        </div>
                        <p class="text-[10px] text-indigo-400 font-bold uppercase mb-2">√âpargne Mensuelle (‚Ç¨)</p>
                        <div class="flex items-center gap-4">
                            <input type="number" id="monthly" value="300" class="input-precision !text-indigo-400"
                                oninput="update()">
                            <div class="flex flex-col gap-1">
                                <button onclick="changeValue('monthly', 50)"
                                    class="w-8 h-8 bg-indigo-900/40 rounded-lg hover:bg-indigo-800 active:scale-95 text-indigo-400 font-bold">+</button>
                                <button onclick="changeValue('monthly', -50)"
                                    class="w-8 h-8 bg-indigo-900/40 rounded-lg hover:bg-indigo-800 active:scale-95 text-indigo-400 font-bold">-</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Param√®tres Temps/Taux -->
            <div class="space-y-6">
                <h3 class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Dur√©e & Strat√©gie</h3>

                <div class="glass-card p-5">
                    <div class="flex justify-between items-center mb-4">
                        <p class="text-xs font-bold text-slate-400">DUR√âE : <span id="txt-years"
                                class="text-white text-base ml-1">20</span> ANS</p>
                    </div>
                    <input type="range" id="years" min="1" max="50" step="1" value="25" oninput="update()">
                </div>

                <div class="glass-card p-5">
                    <div class="flex justify-between items-center mb-4">
                        <p class="text-xs font-bold text-slate-400 uppercase">Mode de calcul</p>
                        <select id="calcMode"
                            class="bg-slate-800 text-[10px] font-bold rounded-lg px-2 py-1 outline-none border border-slate-700"
                            onchange="update()">
                            <option value="stable">Lin√©aire (Stable)</option>
                            <option value="sp500">Historique S&P 500</option>
                        </select>
                    </div>

                    <div id="stable-settings" class="space-y-4">
                        <div class="flex justify-between items-center">
                            <span class="text-xs font-bold text-amber-500" id="txt-rate">8%</span>
                            <span class="text-[10px] text-slate-500 uppercase">Rendement vis√©</span>
                        </div>
                        <input type="range" id="rate" min="0" max="15" step="0.5" value="8" oninput="update()">
                        <div class="flex flex-wrap gap-2">
                            <button onclick="setRate(3)" class="btn-preset">Livret A</button>
                            <button onclick="setRate(7)" class="btn-preset">MSCI World</button>
                            <button onclick="setRate(10)" class="btn-preset active">S&P 500 Avg</button>
                        </div>
                    </div>

                    <div id="sp500-settings" class="hidden space-y-4">
                        <div class="flex justify-between items-center">
                            <label class="text-[10px] font-bold text-slate-400 uppercase">Ann√©e de d√©part</label>
                            <span class="text-xs font-bold text-emerald-500" id="txt-start-year">1990</span>
                        </div>
                        <input type="range" id="startYear" min="1928" max="2024" step="1" value="1990"
                            oninput="update()">
                        <p class="text-[10px] text-slate-500 leading-relaxed italic">
                            Simulation bas√©e sur les rendements r√©els du S&P 500 (dividendes r√©investis) √† partir de
                            l'ann√©e choisie.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Toggles de R√©alit√© -->
            <div class="grid grid-cols-2 gap-4">
                <button id="btn-inflation" onclick="toggleReality('inflation')" class="glass-card p-4 text-left group">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-[10px] font-bold text-slate-500 uppercase">Inflation</span>
                        <div id="dot-inflation" class="w-1.5 h-1.5 rounded-full bg-slate-700"></div>
                    </div>
                    <p class="text-xs font-bold text-slate-400 group-hover:text-white transition-colors">-2.0% / an</p>
                </button>

                <button id="btn-tax" onclick="toggleReality('tax')" class="glass-card p-4 text-left group">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-[10px] font-bold text-slate-500 uppercase">Imp√¥ts</span>
                        <div id="dot-tax" class="w-1.5 h-1.5 rounded-full bg-slate-700"></div>
                    </div>
                    <p class="text-xs font-bold text-slate-400 group-hover:text-white transition-colors">Flat Tax 30%
                    </p>
                </button>
            </div>

            <div class="pt-8 border-t border-slate-800/50">
                <p class="text-[9px] text-slate-600 text-center leading-relaxed">
                    ¬© 2026 L'Atelier Web - Hamza DJOUDI<br>
                    Simulateur indicatif bas√© sur des donn√©es historiques.
                </p>
            </div>
        </div>
    </aside>

    <!-- CONTENT: Visualisation -->
    <main class="flex-1 overflow-y-auto custom-scrollbar bg-slate-950 relative">
        <!-- Floating background elements -->
        <div
            class="absolute top-[10%] left-[10%] w-64 h-64 bg-indigo-600/10 rounded-full blur-[100px] pointer-events-none">
        </div>
        <div
            class="absolute bottom-[10%] right-[10%] w-96 h-96 bg-blue-600/5 rounded-full blur-[120px] pointer-events-none">
        </div>

        <div class="p-6 md:p-12 max-w-5xl mx-auto space-y-12 relative z-10">

            <!-- Result Hero -->
            <div class="text-center space-y-2 animate-fade-in">
                <p class="text-[10px] font-bold text-indigo-400 uppercase tracking-[0.3em]">Capital final projet√©</p>
                <h2 class="text-6xl md:text-8xl font-black gradient-text tracking-tighter" id="total-amount">0 ‚Ç¨</h2>
                <div class="flex justify-center gap-8 pt-4">
                    <div class="text-left">
                        <p class="text-[10px] text-slate-500 font-bold uppercase">Investi</p>
                        <p class="text-lg font-bold" id="total-invested">0 ‚Ç¨</p>
                    </div>
                    <div class="w-px h-8 bg-slate-800 my-auto"></div>
                    <div class="text-left">
                        <p class="text-[10px] text-emerald-400 font-bold uppercase">Plus-value</p>
                        <p class="text-lg font-bold text-emerald-400" id="total-gains">+0 ‚Ç¨</p>
                    </div>
                </div>
            </div>

            <!-- Main Chart Area -->
            <div class="glass-card p-6 md:p-8 bg-slate-900/50">
                <div class="flex justify-between items-center mb-8">
                    <h3 class="text-sm font-bold uppercase tracking-widest text-slate-400">Projection de croissance</h3>
                    <div class="flex gap-4 text-[10px] font-bold uppercase">
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-1 bg-indigo-500 rounded"></div> Patrimoine
                        </div>
                        <div class="flex items-center gap-2 text-slate-500">
                            <div class="w-3 h-1 bg-slate-600 rounded"></div> Mise
                        </div>
                    </div>
                </div>
                <div class="h-[300px] md:h-[450px]">
                    <canvas id="snowballChart"></canvas>
                </div>
            </div>

            <!-- Milestones Grid -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Achievement Card -->
                <div class="glass-card p-6 flex flex-col items-center text-center space-y-4">
                    <div class="w-16 h-16 rounded-2xl bg-slate-800 flex items-center justify-center text-4xl animate-float"
                        id="achievement-emoji">‚òï</div>
                    <div>
                        <p class="text-[10px] font-bold text-slate-500 uppercase mb-1">Status Atteint</p>
                        <h4 class="text-lg font-bold" id="achievement-label">√âpargnant D√©butant</h4>
                    </div>
                    <p class="text-xs text-slate-400 leading-relaxed" id="achievement-desc">
                        C'est un bon d√©but. Votre avenir financier commence ici.
                    </p>
                </div>

                <!-- Coffee Factor Card -->
                <div class="glass-card p-6 bg-amber-500/[0.02] border-amber-500/20">
                    <h4 class="text-xs font-bold text-amber-500 uppercase mb-4 tracking-widest">Coffee Effect ‚òï</h4>
                    <p class="text-xs text-slate-400 mb-6">Et si vous √©conomisiez <strong
                            class="text-white">5‚Ç¨/jour</strong> (150‚Ç¨/mois) de plus ?</p>
                    <div class="space-y-1">
                        <p class="text-[10px] text-slate-500 font-bold uppercase">Plus-value suppl√©mentaire</p>
                        <p class="text-2xl font-black text-amber-500" id="coffee-gain">+0 ‚Ç¨</p>
                    </div>
                    <p class="text-[9px] text-amber-500/50 mt-4 leading-normal">
                        "Les petites rivi√®res font les grands fleuves."
                    </p>
                </div>

                <!-- Time Machine Card -->
                <div class="glass-card p-6 bg-emerald-500/[0.02] border-emerald-500/20">
                    <h4 class="text-xs font-bold text-emerald-500 uppercase mb-4 tracking-widest">R√®gle de 10 ans ‚è∞</h4>
                    <p class="text-xs text-slate-400 mb-6">Si vous aviez commenc√© <strong class="text-emerald-400">10
                            ans plus t√¥t</strong>...</p>
                    <div class="space-y-1">
                        <p class="text-[10px] text-slate-500 font-bold uppercase">Manque √† gagner (estim√©)</p>
                        <p class="text-2xl font-black text-emerald-400" id="regret-loss">-0 ‚Ç¨</p>
                    </div>
                    <p class="text-[9px] text-emerald-500/50 mt-4 leading-normal">
                        Le meilleur moment pour planter un arbre √©tait il y a 20 ans. Le deuxi√®me meilleur moment est
                        aujourd'hui.
                    </p>
                </div>
            </div>
        </div>
    </main>

    <script>
        // --- DATA: HISTORIQUE S&P 500 (1928-2024) ---
        // Rendements annuels dividendes inclus. Source: slickcharts / upmyinterest
        const SP500_RETURNS = {
            1928: 43.61, 1929: -8.42, 1930: -24.90, 1931: -43.34, 1932: -8.19, 1933: 53.99, 1934: -1.44,
            1935: 47.67, 1936: 33.92, 1937: -35.03, 1938: 31.12, 1939: -0.41, 1940: -10.10, 1941: -11.59,
            1942: 20.34, 1943: 25.90, 1944: 19.74, 1945: 36.44, 1946: -8.07, 1947: 5.71, 1948: 5.57,
            1949: 18.29, 1950: 31.71, 1951: 24.02, 1952: 18.37, 1953: -0.99, 1954: 52.62, 1955: 31.56,
            1956: 6.56, 1957: -10.78, 1958: 43.36, 1959: 11.96, 1960: 0.47, 1961: 26.89, 1962: -8.73,
            1963: 22.80, 1964: 16.48, 1965: 12.45, 1966: -10.06, 1967: 23.98, 1968: 11.06, 1969: -8.50,
            1970: 4.01, 1971: 14.31, 1972: 18.98, 1973: -14.66, 1974: -26.47, 1975: 37.20, 1976: 23.84,
            1977: -7.18, 1978: 6.56, 1979: 18.44, 1980: 32.42, 1981: -4.92, 1982: 21.55, 1983: 22.56,
            1984: 6.27, 1985: 31.73, 1986: 18.67, 1987: 5.25, 1988: 16.61, 1989: 31.69, 1990: -3.10,
            1991: 30.47, 1992: 7.62, 1993: 10.08, 1994: 1.32, 1995: 37.58, 1996: 22.96, 1997: 33.36,
            1998: 28.58, 1999: 21.04, 2000: -9.10, 2001: -11.89, 2002: -22.10, 2003: 28.68, 2004: 10.88,
            2005: 4.91, 2006: 15.79, 2007: 5.49, 2008: -37.00, 2009: 26.46, 2010: 15.06, 2011: 2.11,
            2012: 16.00, 2013: 32.39, 2014: 13.69, 2015: 1.38, 2016: 11.96, 2017: 21.83, 2018: -4.38,
            2019: 31.49, 2020: 18.40, 2021: 28.71, 2022: -18.11, 2023: 26.29, 2024: 25.02
        };

        const ACHIEVEMENTS = [
            { threshold: 0, emoji: '‚òï', label: '√âpargneur D√©butant', desc: 'Vous avez pos√© la premi√®re pierre de votre empire.' },
            { threshold: 50000, emoji: 'üöó', label: 'Confort Premium', desc: 'De quoi s\'offrir une tr√®s belle berline neuve comptant.' },
            { threshold: 150000, emoji: 'üè†', label: 'D√©tenteur Immobilier', desc: 'L\'√©quivalent d\'un bel appartement √† Rouen ou d\'une maison de campagne.' },
            { threshold: 300000, emoji: 'üè°', label: 'Solidit√© Patrimoniale', desc: 'Une assise financi√®re confortable pour toute la famille.' },
            { threshold: 500000, emoji: '‚õµ', label: 'Semi-Libert√©', desc: 'Travailler par choix, non par n√©cessit√©. Le luxe ultime.' },
            { threshold: 1000000, emoji: 'üëë', label: 'Millionnaire', desc: 'F√©licitations. Vous faites partie du Top 1% mondial.' },
            { threshold: 5000000, emoji: 'üê≥', label: 'Deep Pocket Whale', desc: 'Un empire b√¢ti sur la discipline et le temps.' }
        ];

        // --- CORE LOGIC ---
        function formatMoney(amount) {
            return new Intl.NumberFormat('fr-FR', { style: 'currency', currency: 'EUR', maximumFractionDigits: 0 }).format(amount);
        }

        function changeValue(id, delta) {
            const input = document.getElementById(id);
            input.value = Math.max(0, parseInt(input.value) + delta);
            update();
        }

        function setRate(r) {
            document.getElementById('rate').value = r;
            document.querySelectorAll('.btn-preset').forEach(b => b.classList.remove('active'));
            event?.target.classList.add('active');
            update();
        }

        function applyBudget() {
            const salary = parseInt(document.getElementById('salaryInput').value) || 0;
            document.getElementById('monthly').value = Math.round(salary * 0.15); // Recommandation 15%
            update();
        }

        let reality = { inflation: false, tax: false };
        function toggleReality(type) {
            reality[type] = !reality[type];
            document.getElementById(`dot-${type}`).className = reality[type] ? "w-1.5 h-1.5 rounded-full bg-indigo-500 shadow-[0_0_10px_#6366f1]" : "w-1.5 h-1.5 rounded-full bg-slate-700";
            document.getElementById(`btn-${type}`).style.borderColor = reality[type] ? "rgba(99, 102, 241, 0.4)" : "";
            update();
        }

        // --- CHART INIT ---
        const ctx = document.getElementById('snowballChart').getContext('2d');
        const gradient = ctx.createLinearGradient(0, 0, 0, 400);
        gradient.addColorStop(0, 'rgba(99, 102, 241, 0.4)');
        gradient.addColorStop(1, 'rgba(99, 102, 241, 0)');

        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [
                    {
                        label: 'Patrimoine Total',
                        data: [],
                        borderColor: '#6366f1',
                        backgroundColor: gradient,
                        fill: true,
                        tension: 0.4,
                        borderWidth: 3,
                        pointRadius: 0,
                        pointHoverRadius: 6,
                        order: 1
                    },
                    {
                        label: 'Mise cumul√©e',
                        data: [],
                        borderColor: '#334155',
                        borderDash: [5, 5],
                        borderWidth: 2,
                        pointRadius: 0,
                        fill: false,
                        tension: 0.1,
                        order: 2
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: { mode: 'index', intersect: false },
                plugins: { legend: { display: false } },
                scales: {
                    x: { grid: { display: false }, ticks: { color: '#64748b', font: { size: 10 } } },
                    y: { grid: { color: '#1e293b' }, ticks: { color: '#64748b', font: { size: 10 }, callback: v => formatMoney(v) } }
                }
            }
        });

        // --- MAIN CALCULATION ---
        function update() {
            const initial = parseInt(document.getElementById('initial').value) || 0;
            const monthly = parseInt(document.getElementById('monthly').value) || 0;
            const years = parseInt(document.getElementById('years').value);
            const calcMode = document.getElementById('calcMode').value;
            const rate = parseFloat(document.getElementById('rate').value);
            const startYear = parseInt(document.getElementById('startYear').value);

            // UI toggles
            document.getElementById('txt-years').innerText = years;
            document.getElementById('txt-rate').innerText = rate + "%";
            document.getElementById('txt-start-year').innerText = startYear;
            document.getElementById('stable-settings').classList.toggle('hidden', calcMode === 'sp500');
            document.getElementById('sp500-settings').classList.toggle('hidden', calcMode === 'stable');

            const labels = [];
            const dataTotal = [];
            const dataMise = [];

            let currentTotal = initial;
            let currentMise = initial;
            let currentYear = startYear;

            labels.push('An 0');
            dataTotal.push(initial);
            dataMise.push(initial);

            for (let i = 1; i <= years; i++) {
                let annualReturn;

                if (calcMode === 'sp500') {
                    // Loop back to start if we exceed 2024
                    const yearToUse = currentYear > 2024 ? 1928 + (currentYear - 2025) : currentYear;
                    annualReturn = (SP500_RETURNS[yearToUse] || 10) / 100;
                    currentYear++;
                } else {
                    annualReturn = rate / 100;
                }

                // Monthly compounding
                const monthlyRate = Math.pow(1 + annualReturn, 1 / 12) - 1;
                for (let m = 0; m < 12; m++) {
                    currentTotal += monthly;
                    currentTotal *= (1 + monthlyRate);
                    currentMise += monthly;
                }

                let displayValue = currentTotal;

                // reality checks
                if (reality.tax) {
                    const gains = displayValue - currentMise;
                    if (gains > 0) displayValue -= (gains * 0.30);
                }
                if (reality.inflation) {
                    displayValue = displayValue / Math.pow(1 + 0.02, i);
                }

                labels.push('An ' + i);
                dataTotal.push(Math.round(displayValue));
                dataMise.push(Math.round(currentMise));
            }

            // Results UI
            const finalValue = dataTotal[dataTotal.length - 1];
            const totalGains = finalValue - currentMise;

            document.getElementById('total-amount').innerText = formatMoney(finalValue);
            document.getElementById('total-invested').innerText = formatMoney(currentMise);
            document.getElementById('total-gains').innerText = "+" + formatMoney(Math.max(0, totalGains));

            // Coffee Effect Comparison (Fixed distance simulation)
            let coffeeTotal = initial;
            let coffeeMise = initial;
            for (let i = 1; i <= years; i++) {
                const annualReturn = calcMode === 'sp500' ? 0.10 : rate / 100; // Simplified for side comparison
                const monthlyRate = Math.pow(1 + annualReturn, 1 / 12) - 1;
                for (let m = 0; m < 12; m++) {
                    coffeeTotal += (monthly + 150); // +5‚Ç¨/jour
                    coffeeTotal *= (1 + monthlyRate);
                    coffeeMise += (monthly + 150);
                }
            }
            document.getElementById('coffee-gain').innerText = "+" + formatMoney(coffeeTotal - finalValue);

            // Regret Loss (Simulate starting 10 years earlier with same end age)
            let regretTotal = initial;
            for (let i = 1; i <= years + 10; i++) {
                const annualReturn = 0.08;
                const monthlyRate = Math.pow(1 + annualReturn, 1 / 12) - 1;
                for (let m = 0; m < 12; m++) {
                    regretTotal += monthly;
                    regretTotal *= (1 + monthlyRate);
                }
            }
            document.getElementById('regret-loss').innerText = "-" + formatMoney(regretTotal - finalValue);

            // Achievements
            const ach = [...ACHIEVEMENTS].reverse().find(a => finalValue >= a.threshold) || ACHIEVEMENTS[0];
            document.getElementById('achievement-emoji').innerText = ach.emoji;
            document.getElementById('achievement-label').innerText = ach.label;
            document.getElementById('achievement-desc').innerText = ach.desc;

            // Chart Update
            chart.data.labels = labels;
            chart.data.datasets[0].data = dataTotal;
            chart.data.datasets[1].data = dataMise;
            chart.update();
        }

        // Init
        window.onload = update;
    </script>
</body>

</html>